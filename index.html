<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì½”ë“œëª…: ì—ê·¸ ë…¸ì´ì¦ˆ - í•„ë“œ ë¡œê·¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    /* ========================================= */
    /* 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ë…¸íŠ¸ë¶/í•„ë“œ ë¡œê·¸) */
    /* ========================================= */
    :root {
      --bg-gray: #111827;
      --paper: #faf7f2;
      --text-main: #2d2d2d;
      --accent-red: #d32f2f;
      --accent-blue: #2563eb;
      --survey-bg: #FFD94D;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh; background: var(--bg-gray);
      font-family: 'Noto Sans KR', sans-serif; line-height: 1.6;
    }

    /* í…ìŠ¤íŠ¸ í•˜ì´ë¼ì´íŠ¸/ìŠ¤íƒ€ì¼ */
    .txt-red { color: #d32f2f; font-weight: 700; }
    .txt-blue { color: #2563eb; font-weight: 700; }
    .txt-highlight {
      background: linear-gradient(120deg, rgba(253, 224, 71, 0.5) 0%, rgba(253, 224, 71, 0.3) 100%);
      box-shadow: inset 0 -8px 0 rgba(253, 224, 71, 0.4); padding: 0 2px; font-weight: 700; color: #422006;
    }
    
    /* ì†ê¸€ì”¨ (ë‹¨ì„œ) */
    .txt-handwritten {
      display: block; font-family: 'East Sea Dokdo', cursive; font-size: 1.9rem; color: #5d4037;
      line-height: 1.25; padding: 15px; margin: 16px 0;
      background: rgba(139, 115, 85, 0.08); border-left: 4px solid #8b7355;
      border-radius: 0 8px 8px 0; transform: rotate(-0.5deg);
    }

    /* ë…¸íŠ¸ë¶ ë ˆì´ì•„ì›ƒ */
    .notebook-card { width: 100%; max-width: 600px; margin: 0 auto; min-height: 100vh; background: #020617; display: flex; flex-direction: column; }
    .spiral-header { padding: 12px 16px 8px; background: linear-gradient(135deg, #020617, #111827); color: #9ca3af; box-shadow: 0 2px 6px rgba(0,0,0,0.5); z-index: 10; }
    .spiral-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .spiral-holes { display: flex; gap: 6px; }
    .spiral-hole { width: 13px; height: 13px; border-radius: 999px; background: #020617; box-shadow: 0 0 0 2px #d4d4d4, inset 0 0 3px rgba(0,0,0,0.9); position: relative; }
    .spiral-wire { position: absolute; left: 50%; transform: translateX(-50%); width: 19px; height: 3px; border-radius: 999px; background: #d4d4d4; box-shadow: 0 2px 0 rgba(0,0,0,0.4), 0 -1px 0 rgba(255,255,255,0.7); }
    .spiral-wire.top { top: -6px; } .spiral-wire.bottom { bottom: -6px; }
    .lab-header-text { text-align: right; font-size: 0.7rem; letter-spacing: 0.1em; color: #6b7280; font-weight: 500; }
    .lab-main-title { margin-top: 4px; font-size: 1.1rem; font-weight: 800; letter-spacing: 0.1em; color: #e5e7eb; }
    .lab-subtitle { margin-top: 2px; font-size: 0.8rem; letter-spacing: 0.15em; color: #9ca3af; }

    .paper-wrap { flex: 1; background: #111827; padding: 0; overflow-y: auto; position: relative; }
    .paper { position: relative; padding: 24px 20px 40px 24px; min-height: 100%; background: var(--paper); background-image: repeating-linear-gradient(to bottom, transparent 0, transparent 27px, #e2ddd4 28px); }
    .paper::before { content: ""; position: absolute; top: 0; bottom: 0; left: 12px; width: 2px; background: linear-gradient(to bottom, transparent, #b8987b, transparent); opacity: 0.7; }

    .paper-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; }
    .paper-label { font-size: 0.75rem; color: #555; letter-spacing: 0.1em; font-weight: 700; margin-bottom: 4px; }
    .paper-title { font-size: 1.3rem; font-weight: 800; color: var(--text-main); line-height: 1.3; letter-spacing: -0.03em; }
    .stage-stamp { display: inline-block; padding: 4px 10px; border: 3px solid var(--accent-red); border-radius: 8px; color: var(--accent-red); font-size: 1rem; font-weight: 900; background: rgba(255, 255, 255, 0.85); transform: rotate(-3deg); font-family: 'Noto Serif KR', serif; }

    .nav-controls { display: flex; justify-content: space-between; margin-bottom: 24px; padding: 0 4px; }
    .nav-btn { padding: 10px 18px; font-size: 0.9rem; font-weight: 700; background: #ffffff; color: #374151; border: 1px solid #c4b5a5; border-radius: 8px; box-shadow: 0 2px 0 #b3a292; cursor: pointer; }
    .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; background: #f3f4f6; border-color: #e5e7eb; box-shadow: none; transform: none; }
    
    .subtitle { font-size: 0.95rem; color: #666; margin: 4px 0 6px; font-weight: 600; letter-spacing: -0.02em; }
    .subtitle-separator { width: 100%; height: 2px; background: #e2ddd4; margin: 12px 0 24px; }

    .story-text { font-size: 1.05rem; color: #333; white-space: pre-line; line-height: 1.75; margin-bottom: 30px; word-break: keep-all; letter-spacing: -0.03em; text-align: left; }

    #answerArea { background: rgba(255,255,255,0.7); padding: 20px 16px; border-radius: 12px; border: 1px solid #e2ddd4; }
    .answer-label-pill { display: inline-block; padding: 4px 10px; border-radius: 6px; background: var(--text-main); color: #fff; font-size: 0.8rem; font-weight: 700; margin-bottom: 8px; }
    input[type="text"] { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #dcdcdc; font-size: 1.1rem; background: #ffffff; color: var(--text-main); transition: all 0.2s; }
    input:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
    button#submitBtn { width: 100%; margin-top: 12px; padding: 14px; border-radius: 8px; border: none; background: #111; color: #ffffff; font-size: 1rem; font-weight: 700; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
    
    .message { margin-top: 8px; font-size: 0.95rem; font-weight: 700; text-align: center; }
    .message.error { color: #d32f2f; }
    .message.success { color: #15803d; padding: 10px; background-color: #dcfce7; border-radius: 8px; border: 1px solid #bbf7d0; }

    .hint-area details { border: 1px solid #d1d5db; border-radius: 8px; background: #fff; margin-top: 12px; overflow: hidden; }
    .hint-area summary { padding: 12px 14px; font-size: 0.95rem; font-weight: 700; cursor: pointer; color: #4b5563; background: #f9fafb; list-style: none; }
    .hint-content { padding: 16px; font-size: 1rem; color: #333; border-top: 1px solid #e5e7eb; word-break: keep-all; }

    /* í´ë¦¬ì–´ í™”ë©´ */
    .clear-block { margin-top: 60px; text-align: center; display: none; padding: 0 20px; }
    .clear-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 16px; border-radius: 999px; border: 2px solid #166534; color: #166534; font-size: 0.9rem; font-weight: 800; background: #dcfce7; margin-bottom: 20px; }
    .clear-title { font-size: 1.8rem; font-weight: 800; margin-bottom: 12px; color: #111; letter-spacing: -0.03em; }
    
    .survey-btn-wrap { margin: 20px 0; padding: 20px 0; border-top: 2px dashed #d1d5db; border-bottom: 2px dashed #d1d5db; }
    .survey-btn { padding: 16px 20px; border-radius: 12px; border: none; background: var(--survey-bg); color: #713f12; font-size: 1.1rem; font-weight: 800; cursor: pointer; box-shadow: 0 4px 0 #eab308; width: 100%; }
    .restart-btn { margin-top: 20px; width: 100%; padding: 14px 10px; border-radius: 999px; border: 1px solid #d1d5db; background: transparent; color: #6b7280; font-size: 0.85rem; font-weight: 600; cursor: pointer; }

    /* ========================================= */
    /* 2. [Type A] ì‹œìŠ¤í…œ ê²½ê³  ì˜¤ë²„ë ˆì´ */
    /* ========================================= */
    .warning-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
      justify-content: center; align-items: center;
      z-index: 900; backdrop-filter: blur(3px);
    }
    .warning-box {
      width: 85%; max-width: 350px; background: #000;
      border: 2px solid #ff0000; padding: 25px; text-align: center;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
      animation: shake 0.4s ease-out;
    }
    .warning-title { color: #ff0000; font-size: 1.6rem; font-weight: 900; margin: 0 0 10px 0; animation: blink 0.8s infinite; }
    .warning-msg { color: #fff; font-size: 0.95rem; margin-bottom: 20px; font-family: monospace; line-height: 1.5; }
    .warning-btn { background: #ff0000; color: #000; border: none; padding: 10px 20px; font-weight: 800; cursor: pointer; text-transform: uppercase; }
    
    @keyframes shake { 0% { transform: scale(0.9); } 60% { transform: scale(1.05); } 100% { transform: scale(1); } }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

    /* ========================================= */
    /* 3. [Type C] ê¸€ë¦¬ì¹˜(ë…¸ì´ì¦ˆ) ì˜¤ë²„ë ˆì´ */
    /* ========================================= */
    .glitch-overlay {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: #000; display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
      justify-content: center; align-items: center; flex-direction: column;
      z-index: 9999; overflow: hidden;
    }
    .glitch-text {
      font-size: 2.5rem; font-weight: 900; color: white; position: relative;
      animation: textShudder 0.1s infinite;
    }
    .glitch-text::before, .glitch-text::after {
      content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8;
    }
    .glitch-text::before { color: #0ff; z-index: -1; animation: glitch-1 0.3s infinite linear alternate-reverse; }
    .glitch-text::after { color: #f0f; z-index: -2; animation: glitch-2 0.3s infinite linear alternate-reverse; }
    .scanlines {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.3));
      background-size: 100% 4px; pointer-events: none;
    }
    
    @keyframes textShudder { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }
    @keyframes glitch-1 { 0% { clip-path: inset(20% 0 80% 0); transform: translate(-2px, 0); } 100% { clip-path: inset(60% 0 10% 0); transform: translate(2px, 0); } }
    @keyframes glitch-2 { 0% { clip-path: inset(10% 0 60% 0); transform: translate(2px, 0); } 100% { clip-path: inset(80% 0 5% 0); transform: translate(-2px, 0); } }

  </style>
</head>
<body>
  
  <div class="glitch-overlay" id="glitchScreen">
    <div class="scanlines"></div>
    <div class="glitch-text" data-text="SYSTEM FAILURE">SYSTEM FAILURE</div>
    <div style="margin-top: 20px; color: red; font-family: monospace;">CONNECTION LOST...</div>
  </div>

  <div class="notebook-card">
    <div class="spiral-header">
      <div class="spiral-row">
        <div class="spiral-holes">
          <div class="spiral-hole"><div class="spiral-wire top"></div><div class="spiral-wire bottom"></div></div>
          <div class="spiral-hole"><div class="spiral-wire top"></div><div class="spiral-wire bottom"></div></div>
          <div class="spiral-hole"><div class="spiral-wire top"></div><div class="spiral-wire bottom"></div></div>
        </div>
        <div class="lab-header-text">BACKWOODS RESEARCH INSTITUTE</div>
      </div>
      <div class="lab-main-title">CODE: EGG NOISE</div>
      <div class="lab-subtitle">GANGCHON BASE</div>
    </div>

    <div class="paper-wrap">
      <div class="warning-overlay" id="warningPopup">
        <div class="warning-box">
          <div class="warning-title">WARNING</div>
          <div class="warning-msg" id="warningMsg">
            ìœ„í—˜ ì§€ì—­ ì ‘ê·¼ ê°ì§€.<br>
            ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
          </div>
          <button class="warning-btn" onclick="confirmWarning()">ì§„ì… ìŠ¹ì¸</button>
        </div>
      </div>

      <div class="paper">
        <div class="paper-header">
          <div class="paper-header-left">
            <div class="paper-label">FIELD NOTES</div>
            <div class="paper-title">ì½”ë“œëª…: ì—ê·¸ ë…¸ì´ì¦ˆ <br> (Code: Egg Noise)</div>
          </div>
          <div class="paper-header-right">
            <div class="stage-stamp" id="stageLabel">STAGE 1</div>
          </div>
        </div>

        <div class="progress-wrap"></div>

        <div class="nav-controls" id="navControls">
            <button class="nav-btn" id="prevBtn">â—€ ì´ì „</button>
            <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â–¶</button>
        </div>

        <div id="gameContent">
            <div class="subtitle" id="stageSubtitle">í˜„ì¥ ë¡œê·¸ë¥¼ ì½ê³  ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
            <div class="subtitle-separator"></div>

            <div class="story-text" id="storyText">
            </div>

            <div id="answerArea">
                <div class="answer-label-pill">INPUT CODE</div>
                <input id="answerInput" type="text" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" inputmode="text" autocomplete="off" />
                <button id="submitBtn">í™•ì¸ (SUBMIT)</button>
                <div id="message" class="message"></div>

                <div id="hintArea" class="hint-area">
                    <details>
                        <summary id="hintSummary">íŒíŠ¸ í™•ì¸í•˜ê¸°</summary>
                        <div class="hint-content" id="hintContent"></div>
                    </details>
                </div>
            </div>
        </div>
        
        <div class="clear-block" id="clearBlock">
          <div class="clear-badge"><span>ğŸ‰</span><span>SYSTEM RESET</span></div>
          <div class="clear-title">í•„ë“œ ë¡œê·¸ ì „ì†¡ ì™„ë£Œ</div>
          <div class="clear-text">
            ëª¨ë“  ë°ì´í„°ê°€ ë³¸ë¶€ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
            ì—°êµ¬ì›ë‹˜ì˜ í¬ìƒì„ ê¸°ë¡í•©ë‹ˆë‹¤.
          </div>

          <div class="survey-btn-wrap">
            <a href="https://forms.gle/y1YVeoTPLMm19ugSA" target="_blank" style="text-decoration: none;">
              <button class="survey-btn">ğŸ’¡ ë§Œì¡±ë„ ì¡°ì‚¬ ì°¸ì—¬í•˜ê¸°</button>
            </a>
          </div>
          <button class="restart-btn" id="restartBtn">ìƒˆë¡œìš´ ë£¨í”„ ì‹œì‘í•˜ê¸° (ì²˜ìŒìœ¼ë¡œ)</button>
        </div>

      </div>
    </div>
  </div>

  <script>
    // í•„ë“œ ë¡œê·¸ ë°ì´í„° (ê°€ë…ì„± ê°œì„  ë²„ì „)
    const puzzles = [
      // 0. í”„ë¡¤ë¡œê·¸
      {
        subtitle: "í”„ë¡¤ë¡œê·¸. ì‚¬ë¼ì§„ ì‹œëŒ€ì˜ ì”í–¥",
        text: `<strong>[1. ì§€í˜• ë¶„ì„]</strong><br>
    ê°•ì´Œì˜ ëŠ¥ì„ ê³¼ ê°•ë¬¼ì€ í‰ë²”í•˜ì§€ ì•Šë‹¤. ì „ì„¤ì— ë”°ë¥´ë©´ ì´ê³³ì€ ì£½ì€ ê²Œ ì•„ë‹ˆë¼ ì ë“¤ì–´ ìˆëŠ” <strong>'ê±°ëŒ€ ë¹„í–‰ ìƒëª…ì²´'</strong> ê·¸ ìì²´ë‹¤.<br><br>

    <strong>[2. ì•„í‹°íŒ©íŠ¸ ë°œê²¬]</strong><br>
    ì‚°ì† ê¹Šì€ ê³³ì—ì„œ <span class="txt-highlight">ì•Œ ëª¨ì–‘ì˜ ê²°ì •ì²´(Artifact)</span>ê°€ ë°œê²¬ë˜ì—ˆë‹¤. ì´ê²ƒì€ ë‹¨ìˆœí•œ ìœ ë¬¼ì´ ì•„ë‹ˆë¼, ì´ê³³ì˜ ì˜¤ë˜ëœ ê¸°ì–µì„ í¡ìˆ˜í•˜ëŠ” ì‹ í˜¸ê¸°ë‹¤.<br><br>

    <strong>[3. ì„ë¬´ ì‹œì‘]</strong><br>
    í˜„ì¬ ê°•ì´Œ ì¼ëŒ€ì— ì •ì²´ë¶ˆëª…ì˜ ì—ë„ˆì§€ ê³µì§„ì´ ê¸‰ì¦í•˜ê³  ìˆë‹¤. ë‹¹ì‹ ì€ ì´ë¥¼ ê°ì§€í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ <span class="txt-blue">ê°ì‘ì(Sensor)</span>ë¡œì„œ í˜„ì¥ì— íŒŒê²¬ë˜ì—ˆë‹¤.<br><br>
    
    <strong>[ì§€ì‹œ]</strong> ê±°ëŒ€í•œ ë¬´ì–¸ê°€ê°€ ê¹¨ì–´ë‚˜ê³  ìˆë‹¤. <strong>'ì‹œì‘'</strong>ì„ ì…ë ¥í•˜ì—¬ ì¡°ì‚¬ë¥¼ ê°œì‹œí•˜ë¼.`, 
        answer: "ì‹œì‘",
        hint: "í”„ë¡¤ë¡œê·¸ë¥¼ í™•ì¸í–ˆë‹¤ë©´ 'ì‹œì‘'ì„ ì…ë ¥í•˜ì„¸ìš”."
      },
      // 1. ì—­ -> ìƒë¡ (ìˆ˜ì²© ë°œê²¬)
      {
        subtitle: "í”„ë¡¤ë¡œê·¸. ìˆ˜ì²©ì„ ì¤ë‹¤",
        text: `<strong>[ìœ„ì¹˜]</strong> ê°•ì´Œì—­ í”Œë«í¼<br>
    <strong>[í˜„ìƒ]</strong> <span class="txt-blue">í™˜ì²­ ë° ê³µëª…ìŒ</span> ê°ì§€ ì‹œì‘.<br><br>

    ë°œì¹˜ì—ì„œ ë‚¡ì€ ìˆ˜ì²© í•˜ë‚˜ë¥¼ ìŠµë“í–ˆë‹¤. ìˆ˜ì²©ì„ ì¥ëŠ” ìˆœê°„, ë¯¸ì„¸í•œ ì§„ë™ê³¼ í•¨ê»˜ ì²« ë²ˆì§¸ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚¬ë‹¤.<br>

    <div class="txt-handwritten">
    ì´ ìˆ˜ì²©ì„ ì¤ëŠ” ì,<br>
    ê°•ì˜ ë§¥ë°•ì„ ë“£ê²Œ ë˜ë¦¬ë¼.
    </div>

    <strong>[ë¶„ì„ ê²°ê³¼]</strong><br>
    ìˆ˜ì²©ê³¼ ì•„í‹°íŒ©íŠ¸ê°€ ë™ê¸°í™”ë˜ì—ˆë‹¤. ê³µëª… ì‹ í˜¸ê°€ ê°€ë¦¬í‚¤ëŠ” ì²« ë²ˆì§¸ ì¢Œí‘œëŠ” ì—­ ì•ì˜ <strong>'ì¹´í˜'</strong>ë¡œ í™•ì¸ë¨.<br><br>

    (ê°•ì˜ì‹¤ ë°–, ë²½ë©´ì˜ QRì½”ë“œë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.)`,
        answer: "ìƒë¡",
        hint: "ì •ë‹µ í˜•íƒœ: í•œê¸€, ê°€ë ¤ì§„ ë¶€ë¶„ì˜ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
      },
      // 2. ìƒë¡ -> ì¢…ë§ (ë„ë¡œí‘œì§€íŒ)
      {
        subtitle: "1ì¥. ì”ì¬ íŒŒë™ì´ ê¹¨ì–´ë‚˜ë‹¤",
        text: `<strong>[ìˆ˜ì²© ë°ì´í„° í•´ë…]</strong><br>
    ì§€ë„ ìœ„ì— <span class="txt-highlight">í¬ë¯¸í•œ ì„ </span>ì´ ë‚˜íƒ€ë‚¬ë‹¤. ì´ê²ƒì€ ë‹¨ìˆœí•œ ë„ë¡œê°€ ì•„ë‹Œ, ë•… ë°‘ì— íë¥´ëŠ” <span class="txt-blue">ì—ë„ˆì§€ í˜ˆê´€</span>ì˜ ê²½ë¡œë‹¤.<br><br>
    
    <strong>[ë°˜ì‘]</strong><br>
    ì•„í‹°íŒ©íŠ¸ ì§„ë™ ê°ì§€. ì²™ì¶”ë¥¼ íƒ€ê³  ì˜¤ë¥´ëŠ” ì „ìœ¨ì´ ëŠê»´ì§„ë‹¤.<br><br>

    <strong>[ëª©í‘œ ì§€ì ]</strong><br>
    ì–¸ë• ì•„ë˜ ì‚¬ê±°ë¦¬. ê°€ì¥ í° íŒŒì¥ì´ ëŠê»´ì§€ëŠ” <span class="txt-red">ë„ë¡œí‘œì§€íŒ</span>ì„ ì¡°ì‚¬í•  ê²ƒ.<br><br>

    (ì™¼ìª½ìœ¼ë¡œ ì´ë™. ì •ë©´ ê³„ë‹¨ ë²½ë©´ì˜ QRì½”ë“œ í™•ì¸.)`,
        answer: "ì¢…ë§",
        hint: "ì •ë‹µ í˜•íƒœ: í•œê¸€, ë„ë¡œ í‘œì§€íŒì˜ ê°€ë ¤ì§„ ë‹¨ì–´."
      },
      // 3. ì¢…ë§ -> OWNER (í¸ì˜ì )
      {
        subtitle: "2ì¥. ê¸°ì–µì„ ë¨¹ëŠ” ê³µì§„",
        text: `<strong>[í˜„ìƒ ê´€ì¸¡]</strong><br>
    ì‚¬ê±°ë¦¬ë¥¼ ì§€ë‚˜ì ì•„í‹°íŒ©íŠ¸ì˜ ì§„ë™ ì£¼ê¸°ê°€ ê¸‰ê²©íˆ ë¹¨ë¼ì¡Œë‹¤. ì´ê³³ì— ë‚¨ê²¨ì§„ 'ê°ì •ì˜ ì”ì¬'ë¥¼ ê³¼ë„í•˜ê²Œ í¡ìˆ˜í•˜ê³  ìˆë‹¤.<br><br>

    <strong>[ìˆ˜ì²©ì˜ ë³€í™”]</strong><br>
    í˜ì´ì§€ ìœ„ë¡œ ê±°ì¹œ ì„  ë‘ ê°œê°€ êµì°¨í•˜ë©°, ì´ì „ë³´ë‹¤ í›¨ì”¬ <span class="txt-red">ê³µê²©ì ì¸ í˜•íƒœì˜ ë¬¸ì–‘</span>ì´ ë‚˜íƒ€ë‚¬ë‹¤.<br><br>

    <strong>[ê²½ê³ ]</strong><br>
    ë‚ ì¹´ë¡œìš´ ê³µëª…ìŒì´ ë“¤ë¦°ë‹¤. ê°ì‘ìì˜ ê¸°ë ¥ì´ ë¹ ë¥´ê²Œ ì†Œëª¨ë˜ê³  ìˆë‹¤. íŒŒë™ì˜ ê·¼ì›ì§€ëŠ” ê¸¸ ê±´ë„ˆí¸ì´ë‹¤.<br><br>

    <strong>[ëª©í‘œ]</strong> <strong>í¸ì˜ì  ë°©í–¥</strong>ìœ¼ë¡œ ì´ë™í•˜ì—¬ ê±´ë¬¼ì„ ê´€ì¸¡í•˜ë¼.<br><br>
    (2ì¸µìœ¼ë¡œ ì´ë™. ê²Œì‹œíŒ ê·¼ì²˜ QRì½”ë“œ í™•ì¸.)`,
        answer: "OWNER",
        hint: "ì •ë‹µ í˜•íƒœ: ì˜ì–´, ê±´ë¬¼ì˜ ì°½ë¬¸ ëª¨ì–‘ê³¼ ì•ŒíŒŒë²³ ì¡°í•©."
      },
      // 4. OWNER -> ì„ ëŒ€ì˜ ìœ ì„œ (ë§ˆì„íšŒê´€)
      {
        subtitle: "3ì¥. ì§€í˜•ê³¼ íŒŒë™ì´ ë§ë¬¼ë¦¬ë‹¤",
        text: `<strong>[ê°€ì„¤ ê²€ì¦]</strong><br>
    ì´ê³³ì˜ ê³¨ëª©ê³¼ ê±´ë¬¼ì€ ê±°ëŒ€ ê¸°ê³„ ì¥ì¹˜ì˜ ë¶€ì†í’ˆì²˜ëŸ¼ ë°˜ì‘ ì¤‘ì´ë‹¤.<br>
    <span class="txt-red">ì§€í˜• ìì²´ê°€ ì•„í‹°íŒ©íŠ¸ì™€ ê³µëª…</span>í•˜ê³  ìˆë‹¤.<br><br>

    <strong>[ê²°ë¡  ë„ì¶œ]</strong><br>
    ì´ ì§€ë„ëŠ” ê°•ì´Œ ì „ì²´ë¥¼ ì—°ê²°í•œ <span class="txt-blue">ê±°ëŒ€ ìƒëª…ì²´ì˜ ì‹ ê²½ë§ë„</span>ë‹¤.<br>
    ìš°ë¦¬ëŠ” ì§€ê¸ˆ ìƒëª…ì²´ì˜ ëª¸ ìœ„ë¥¼ ê±·ê³  ìˆëŠ” ê²ƒê³¼ ê°™ë‹¤.<br><br>

    <strong>[ì´ë™ ê²½ë¡œ]</strong><br>
    íŒŒë™ ì‹ í˜¸ê°€ <strong>ë§ˆì„íšŒê´€ ì•</strong>ì—ì„œ ê°•í•˜ê²Œ ê°ì§€ëœë‹¤.<br><br>

    (ì˜¤ë¥¸ìª½ ë³µë„ë¡œ ì´ë™. ë³µë„ ë ê³„ë‹¨ ì•ˆìª½ QRì½”ë“œ í™•ì¸.)`,
        answer: "ì„ ëŒ€ì˜ ìœ ì„œ",
        hint: "ì •ë‹µ í˜•íƒœ: í•œê¸€. ë…¸ì„ ë„ ì •ë¥˜ì¥ê³¼ ê¸€ì ìˆœì„œ ì¡°í•©."
      },
      // 5. ì„ ëŒ€ì˜ ìœ ì„œ -> ê°•ë¬¼ (ë¶í•œê°•)
      {
        subtitle: "4ì¥. ìœ ì„œê°€ ê°€ë¦¬í‚¤ëŠ” ê³³",
        text: `<strong>[íˆë“  í˜ì´ì§€ ê°œë°©]</strong><br>
    ìœ ì„œëŠ” ë‹¨ìˆœí•œ ìœ ì–¸ì´ ì•„ë‹Œ, ì§€í˜•ì§€ë¬¼ì„ í•´ë¶€í•œ <span class="txt-blue">ì„¤ê³„ë„</span>ì˜€ë‹¤.<br>

    <div class="txt-handwritten">
    ì´ê³³ì„ íë¥´ëŠ” ë¬¼ì¤„ê¸°ëŠ” ë‹¨ìˆœí•œ ê°•ì´ ì•„ë‹ˆë‹¤.<br>
    ì ë“¤ì–´ ìˆëŠ” ê±°ì‹ ì˜ <span class="txt-red">í˜ˆê´€</span>ì´ë‹¤.
    </div>

    <strong>[ì„ë¬´]</strong><br>
    ì§„ìœ„ í™•ì¸ì´ í•„ìš”í•˜ë‹¤. ë¶í•œê°•ë³€ì˜ <span class="txt-highlight">ë…¸ë€ ì¡°í˜•ë¬¼</span> ê·¼ì²˜ì—ì„œ í˜ˆê´€ì˜ ë§¥ë°•ì„ ì¸¡ì •í•˜ë¼.<br><br>

    (ê·¼ì²˜ì— ë¶€ì°©ëœ QRì½”ë“œ í™•ì¸.)`,
        answer: "ê°•ë¬¼",
        hint: "í•œê¸€, ê°•ì´Œì— ì—†ì–´ì„œëŠ” ì•ˆ ë˜ëŠ” ê²ƒ."
      },
      // 6. ê°•ë¬¼ -> ë¬¼ì•ˆê°œë¡œ í”¼ì–´ë‚˜ê³  (ëŒ€í”¼ì†Œ) *ìœ„í—˜ êµ¬ê°„ ì§„ì…ì´ì§€ë§Œ í…ìŠ¤íŠ¸ë¡œë§Œ ì²˜ë¦¬*
      {
        subtitle: "5ì¥. ìœ„í—˜í•œ ë§¥ë°•",
        text: `<strong>[ê¸´ê¸‰ ê²½ê³ ]</strong><br>
    ë¶í•œê°•ì´ ë¶‰ì€ í•ë¹›ìœ¼ë¡œ ê´€ì¸¡ë¨. ì•„í‹°íŒ©íŠ¸ê°€ ë¹„ëª…(Scream)ì„ ì§€ë¥´ê³  ìˆë‹¤.<br><br>

    <strong>[ì›ì¸ ë¶„ì„]</strong><br>
    í˜ˆê´€ì— ê³¼ë„í•˜ê²Œ ì ‘ê·¼í–ˆë‹¤. ê±°ëŒ€ ìƒëª…ì²´ì˜ ë©´ì—­ ì²´ê³„ê°€ ë‹¹ì‹ ì„ <span class="txt-red">ì¹¨ì…ì(Virus)</span>ë¡œ ì¸ì‹í•˜ì—¬ ê³µê²©ì„ ê°œì‹œí–ˆë‹¤.<br><br>

    <strong>[ëŒ€ì‘ í–‰ë™]</strong><br>
    ì¦‰ì‹œ <span class="txt-blue">ëŒ€í”¼ì†Œ</span>ë¡œ ì´ë™í•  ê²ƒ. ì¢Œí‘œëŠ” <strong>ì¹´í˜ 'THE1939'</strong>ë‹¤.<br><br>

    (ì˜ìƒë°”ì´ì˜¤ê´€ 414í˜¸ ë…¸í¬. ì•”êµ¬í˜¸: 'ì—´ë ¤ë¼ ì°¸ê¹¨')`,
        answer: "ë¬¼ì•ˆê°œë¡œ í”¼ì–´ë‚˜ê³ ",
        hint: "ì •ë‹µ í˜•íƒœ: í•œê¸€, ë¹„ë°€ìš”ì›ì—ê²Œ ë¬¸ì˜ ë˜ëŠ” QRì½”ë“œ ì¬í™•ì¸."
      },
      // 7. ë¬¼ì•ˆê°œ -> í”¼ì•”í„°ë„ (ê°ˆë¹„ë¼ˆ) *ì—¬ê¸°ê°€ Climax: ê²½ê³ ì°½ ë°œìƒ ì§€ì *
      {
        subtitle: "6ì¥. ë“œëŸ¬ë‚œ ë¼ˆ",
        text: `<strong>[ìƒíƒœ ë³´ê³ ]</strong><br>
    ëŒ€í”¼ì†Œì—ì„œ í˜¸í¡ í™•ë³´. ê·¸ëŸ¬ë‚˜ ìˆ˜ì²©ì˜ 5í˜ì´ì§€ê°€ ì—´ë¦¬ì ì•„í‹°íŒ©íŠ¸ê°€ ë‹¤ì‹œ <span class="txt-red">í­ì£¼</span>í•œë‹¤.<br><br>
    
    <strong>[ê´€ì¸¡ ëŒ€ìƒ]</strong><br>
    ë‹¨ìˆœí•œ í„°ë„ì´ ì•„ë‹ˆë‹¤. ì•„í‹°íŒ©íŠ¸ëŠ” "ë³¸ì²´ ë³µê·€"ë¥¼ ì‹œë„í•˜ê³  ìˆë‹¤.<br>
    í•´ë‹¹ êµ¬ì¡°ë¬¼ì€ ë•… ìœ„ë¡œ ë“œëŸ¬ë‚œ <span class="txt-highlight"><span class="txt-red">ê±°ëŒ€í•œ ê°ˆë¹„ë¼ˆ</span></span>ë¡œ íŒëª…ë˜ì—ˆë‹¤.<br><br>

    <strong>[ìœ„í—˜]</strong><br>
    ë‹¹ì‹ ì€ ì œ ë°œë¡œ í¬ì‹ìì˜ ë±ƒì†(Rib cage)ìœ¼ë¡œ ì§„ì…í•˜ê³  ìˆë‹¤.<br><br>

    (ì—˜ë¦¬ë² ì´í„° ë‚´ë¶€ ë²½ë©´ QRì½”ë“œ í™•ì¸. íƒ‘ìŠ¹í•˜ì§€ ë§ ê²ƒ.)`,
        answer: "í”¼ì•”í„°ë„",
        hint: "ì •ë‹µ í˜•íƒœ: í•œê¸€, í„°ë„ ì´ë¦„(OOOO) ì…ë ¥."
      },
      // 8. í”¼ì•”í„°ë„ -> 13 (í¬í† ì¡´)
      {
        subtitle: "7ì¥. ê°ì‘ìì˜ ì§„ì‹¤",
        text: `<strong>[ìµœì¢… í˜ì´ì§€ í•´ë…]</strong><br>
    ê°ˆë¹„ë¼ˆ(í„°ë„) ë‚´ì—ì„œ ê°ì‘ìì˜ ì—­í• ì— ëŒ€í•œ ì§„ì‹¤ì´ ë“œëŸ¬ë‚¬ë‹¤.<br>

    <div class="txt-handwritten">
    ê°ì‘ìëŠ” ì„¸ê³„ë¥¼ ì§€íƒ±í•˜ëŠ” ë¶€í’ˆì´ë‹¤.<br>
    ì´ ìˆ˜ì²©ì€ ë¶€í’ˆì„ íšŒìˆ˜í•˜ê¸° ìœ„í•œ <span class="txt-red" style="font-family:inherit;">ì¥ì¹˜</span>ë‹¤.
    </div>

    <strong>[ìƒí™© íŒë‹¨]</strong><br>
    ìš°ë¦¬ëŠ” ì˜ì›…ìœ¼ë¡œ ì„ íƒëœ ê²ƒì´ ì•„ë‹ˆì—ˆë‹¤. ê³¼ê±° ì‹¤ì¢…ëœ ê°ì‘ìë“¤ì€ ëª¨ë‘ ì´ê³³ì—ì„œ <span class="txt-red">'ì‚¬ìš©'</span>ë˜ì–´ ì†Œë©¸í–ˆë‹¤.<br><br>

    <strong>[íƒˆì¶œ]</strong><br>
    ì´ê³³ì„ ë²—ì–´ë‚˜ì•¼ í•œë‹¤. ë‹¤ì‹œ <span class="txt-blue">ê°•ì´Œì—­(ê°•ì˜ì‹¤)</span> ë°©í–¥ìœ¼ë¡œ íšŒê·€í•˜ë¼. ìƒìƒì—­ ë’¤í¸ <span class="txt-red">í¬í† ì¡´</span>ì—ì„œ ë¶‰ì€ ì‹ í˜¸ê°€ ì¡íŒë‹¤.<br><br>

    (3ì¸µ ê³„ë‹¨ ë²½ë©´ QRì½”ë“œ í™•ì¸.)`,
        answer: "13",
        hint: "ì •ë‹µ í˜•íƒœ: ìˆ«ì. í´ì§„ ì†ê°€ë½ ê°œìˆ˜."
      },
      // 9. Final (ì—”ë”©)
      {
        subtitle: "ìµœì¢…ì¥. ë‹¤ì‹œ, ì‹œì‘",
        text: `<strong>[ì¢…ë£Œ ì‹œí€€ìŠ¤]</strong><br>
    ê°•ì´Œì—­ ë„ì°© ì§í›„, ì•„í‹°íŒ©íŠ¸ê°€ ì„ê³„ì ì„ ëŒíŒŒí–ˆë‹¤. ê³µê°„ ì™œê³¡ ë°œìƒ, ì§€ë©´ ì†Œì‹¤.<br><br>
    
    <strong>[ê²°ê³¼]</strong><br>
    ì—°êµ¬ì›(ê°ì‘ì) <div class="txt-handwritten" style="display:inline-block; margin:0; padding:2px;"><span class="txt-glow txt-blue">ì„ íƒ ì™„ë£Œ.</span></div><br>
    ì¡°ìš©í•œ íŒŒì—´ìŒê³¼ í•¨ê»˜ ì—°êµ¬ì›ì€ ì†Œë©¸í–ˆë‹¤.<br><br>
    
    <strong>[ì”ë¥˜ë¬¼]</strong><br>
    ê°•ì´Œì—­ ë°”ë‹¥ì— ë¬¸ì–‘ì´ ì‚¬ë¼ì§„ ë‚¡ì€ <strong>ìˆ˜ì²©</strong>ë§Œ ë‚¨ì•˜ë‹¤.<br><br>
    
    ...ì ì‹œ í›„, ë‹¤ë¥¸ ì—°êµ¬ì›ì´ ìˆ˜ì²©ì„ ë°œê²¬í•œë‹¤.<br>
    <div class="txt-handwritten">ì´ ìˆ˜ì²©ì„ ì¤ëŠ” ì...</div><br>
    
    <span class="txt-blue">ê³µì§„(Resonance) ì¬ê°€ë™.</span><br>
    ë‹¹ì‹ ì€ ìˆ˜ì²©ì„... <span class="txt-red">'ì§‘ì–´ë“ ë‹¤'.</span>`, 
        answer: "ì§‘ì–´ë“ ë‹¤", 
        hint: "ë§ˆì§€ë§‰ í–‰ë™ì„ ì…ë ¥í•˜ì„¸ìš”. (4ê¸€ì)"
      }
    ];

    // ë³€ìˆ˜ë“¤
    const totalStages = puzzles.length;
    let currentStage = 0;
    let maxUnlockedStage = 0;
    let pendingNextStage = 0; // ê²½ê³ ì°½ í™•ì¸ í›„ ì´ë™í•  ìŠ¤í…Œì´ì§€ ë²ˆí˜¸

    const stageLabelEl    = document.getElementById("stageLabel");
    const stageSubtitleEl = document.getElementById("stageSubtitle");
    const storyTextEl     = document.getElementById("storyText");
    const messageEl       = document.getElementById("message");
    const hintAreaEl      = document.getElementById("hintArea");
    const hintContentEl   = document.getElementById("hintContent");
    const answerInputEl   = document.getElementById("answerInput");
    const submitBtnEl     = document.getElementById("submitBtn");
    const answerAreaEl    = document.getElementById("answerArea");
    const clearBlockEl    = document.getElementById("clearBlock");
    const restartBtnEl    = document.getElementById("restartBtn");
    const gameContentEl   = document.getElementById("gameContent");
    const prevBtnEl       = document.getElementById("prevBtn");
    const nextBtnEl       = document.getElementById("nextBtn");
    const navControlsEl   = document.getElementById("navControls");
    
    // ì˜¤ë²„ë ˆì´ ì—˜ë¦¬ë¨¼íŠ¸
    const warningPopup = document.getElementById("warningPopup");
    const warningMsg = document.getElementById("warningMsg");
    const glitchScreen = document.getElementById("glitchScreen");

    function normalize(text) {
      return text.trim().replace(/\s/g, '').toLowerCase(); 
    }

    function updateProgress() {
      const total = totalStages;
      stageLabelEl.textContent    = `STAGE ${currentStage + 1} / ${total}`;
    }

    function renderStage() {
      if (gameContentEl) gameContentEl.style.display = "block";
      if (clearBlockEl) clearBlockEl.style.display = "none";
      if (navControlsEl) navControlsEl.style.display = "flex";

      const p = puzzles[currentStage];

      stageSubtitleEl.textContent = p.subtitle || "í˜„ì¥ ë¡œê·¸";
      storyTextEl.innerHTML       = p.text || ""; 
      messageEl.textContent       = "";
      messageEl.className         = "message";

      answerInputEl.value    = "";
      answerInputEl.disabled = false;
      submitBtnEl.disabled   = false;
      submitBtnEl.textContent = "í™•ì¸ (SUBMIT)";
      answerAreaEl.style.display = "block";

      hintContentEl.textContent = p.hint || "ì œê³µëœ íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.";

      if (currentStage === 0 || currentStage === 1) {
          hintAreaEl.classList.add("active");
      } else {
          hintAreaEl.classList.remove("active");
      }
      const hintDetails = hintAreaEl.querySelector('details');
      if (hintDetails) hintDetails.removeAttribute('open');

      prevBtnEl.disabled = (currentStage === 0);
      nextBtnEl.disabled = (currentStage >= maxUnlockedStage);

      updateProgress();
      window.scrollTo(0, 0); 
    }

    function checkAnswer() {
      const userAnswer = normalize(answerInputEl.value);
      const correct    = normalize(puzzles[currentStage].answer || "");

      if (!userAnswer) {
        messageEl.textContent = "ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        messageEl.className   = "message error";
        return;
      }

      if (userAnswer === correct) {
        messageEl.textContent = "âœ… ì½”ë“œ í™•ì¸. ì ‘ê·¼ ìŠ¹ì¸.";
        messageEl.className   = "message success";

        submitBtnEl.disabled   = true;
        answerInputEl.disabled = true;
        
        // ë§ˆì§€ë§‰ ìŠ¤í…Œì´ì§€(ì—”ë”©)ì¸ ê²½ìš° -> Cíƒ€ì… ê¸€ë¦¬ì¹˜ ë°œë™
        if (currentStage === totalStages - 1) {
           submitBtnEl.textContent = "ì´ˆê¸°í™” ì¤‘...";
           setTimeout(() => {
             triggerGlitch();
           }, 1000);
           return;
        }

        // ì¼ë°˜ ìŠ¤í…Œì´ì§€
        submitBtnEl.textContent = "ë°ì´í„° ì „ì†¡ ì¤‘...";
        setTimeout(() => {
          submitBtnEl.textContent = "í™•ì¸ (SUBMIT)";
          
          if (currentStage === maxUnlockedStage) {
             maxUnlockedStage++;
          }
          
          // ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ë„˜ì–´ê°ˆ ë•Œ ìœ„í—˜ ì²´í¬
          attemptMoveToStage(currentStage + 1);

        }, 800);
      } else {
        messageEl.textContent = "âŒ ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        messageEl.className   = "message error";
      }
    }

    // ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ì´ë™ ì‹œë„ (ê²½ê³ ì°½ ë¡œì§ í¬í•¨)
    function attemptMoveToStage(targetStage) {
      // 1. [Type A ê²½ê³ ] ìŠ¤í…Œì´ì§€ 7(í”¼ì•”í„°ë„) ì§„ì… ì‹œì—ë§Œ ë°œìƒ (1íšŒ í•œì •)
      if (targetStage === 7 && currentStage < 7) {
        showWarning(targetStage, "â›” ìœ„í—˜: ê±°ëŒ€ ìƒëª…ì²´ ë‚´ë¶€\nì´ê³³ì€ ë†ˆì˜ ë±ƒì†ì…ë‹ˆë‹¤.\nìƒì¡´ í™•ë¥  ë¯¸ë§Œ.");
        return;
      }

      // ê²½ê³  ì—†ìœ¼ë©´ ë°”ë¡œ ì´ë™
      currentStage = targetStage;
      renderStage();
    }

    // ê²½ê³ ì°½ ë„ìš°ê¸°
    function showWarning(nextStageIdx, msg) {
      pendingNextStage = nextStageIdx;
      warningMsg.innerHTML = msg.replace(/\n/g, "<br>");
      warningPopup.style.display = 'flex';
    }

    // ê²½ê³ ì°½ í™•ì¸ ë²„íŠ¼
    window.confirmWarning = function() {
      warningPopup.style.display = 'none';
      currentStage = pendingNextStage;
      renderStage();
    }

    // ê¸€ë¦¬ì¹˜ ì—°ì¶œ (ì—”ë”©)
    function triggerGlitch() {
      glitchScreen.style.display = 'flex';
      // 3.5ì´ˆ í›„ í´ë¦¬ì–´ í™”ë©´ìœ¼ë¡œ
      setTimeout(() => {
        glitchScreen.style.display = 'none';
        showClear();
      }, 3500);
    }

    function showClear() {
      stageLabelEl.textContent    = `SYSTEM RESET`;
      if (gameContentEl) gameContentEl.style.display = "none";
      if (navControlsEl) navControlsEl.style.display = "none";
      if (clearBlockEl) clearBlockEl.style.display  = "block";
      window.scrollTo(0, 0);
    }

    // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
    prevBtnEl.addEventListener("click", () => {
      if (currentStage > 0) {
        currentStage--;
        renderStage();
      }
    });

    nextBtnEl.addEventListener("click", () => {
      if (currentStage < maxUnlockedStage) {
        attemptMoveToStage(currentStage + 1);
      }
    });

    submitBtnEl.addEventListener("click", checkAnswer);
    answerInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") checkAnswer();
    });

    if (restartBtnEl) {
      restartBtnEl.addEventListener("click", () => {
        if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ë£¨í”„ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            currentStage = 0;
            maxUnlockedStage = 0; 
            renderStage();
        }
      });
    }

    renderStage();
  </script>
</body>
</html>
